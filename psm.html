<!DOCTYPE html>
<html lang="en"><head>
<script src="psm_files/libs/clipboard/clipboard.min.js"></script>
<script src="psm_files/libs/quarto-html/tabby.min.js"></script>
<script src="psm_files/libs/quarto-html/popper.min.js"></script>
<script src="psm_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="psm_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="psm_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="psm_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="psm_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.3.450">

  <meta name="author" content="Son Mendizábal">
  <title>Propensity Score Matching</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="psm_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="psm_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="psm_files/libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="styles.css">
  <link href="psm_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="psm_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="psm_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="psm_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="psm_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="psm_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Propensity Score Matching</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Son Mendizábal 
</div>
</div>
</div>

</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Agenda</h2>
<ul>
<li><a href="#/contexto" id="/toc-contexto">Contexto</a></li>
<li><a href="#/workflow-de-inferencia-causal" id="/toc-workflow-de-inferencia-causal">Workflow de inferencia causal</a></li>
<li><a href="#/datos" id="/toc-datos">Datos</a></li>
<li><a href="#/pregunta-causal" id="/toc-pregunta-causal">1. Pregunta causal</a></li>
<li><a href="#/diagrama-causal" id="/toc-diagrama-causal">2. Diagrama causal</a></li>
<li><a href="#/modelar-hipótesis" id="/toc-modelar-hipótesis">3. Modelar hipótesis</a></li>
<li><a href="#/diagnostico" id="/toc-diagnostico">4. Diagnostico</a></li>
<li><a href="#/estimar-efecto-causal" id="/toc-estimar-efecto-causal">5. Estimar efecto causal</a></li>
<li><a href="#/dudas" id="/toc-dudas">Dudas</a></li>
<li><a href="#/referencias" id="/toc-referencias">Referencias</a></li>
<li><a href="#/librerías" id="/toc-librerías">Librerías</a></li>
</ul>
</nav>
</section>
<section>
<section id="contexto" class="title-slide slide level1 center">
<h1>Contexto</h1>
<p>Un stakeholder pide “drivers” de un acontecimiento concreto, ¿qué está pidiendo? ¿Un modelo para predecir el suceso? ¿Un conocimiento más profundo de las causas del suceso?</p>
<blockquote>
<p>Es una petición vaga, pero suena a interés causal.</p>
</blockquote>
<p>Las tres prácticas comunes de análisis:</p>
<ol type="1">
<li>Descripción</li>
<li>Predicción</li>
<li>Causalidad</li>
</ol>
</section>
<section id="técnicas-de-causalidad" class="slide level2">
<h2>Técnicas de causalidad</h2>
<blockquote>
<p><span class="math inline">\(X\)</span> causa <span class="math inline">\(Y\)</span> si… intervenimos y cambiamos <span class="math inline">\(X\)</span> sin modificar lo demás… y <span class="math inline">\(Y\)</span> cambia.</p>
</blockquote>
<p>En la práctica, esto significa utilizar técnicas como:</p>
<ul>
<li>Diseño de un estudio (por ejemplo, un ensayo aleatorio)</li>
</ul>
<blockquote>
<p>Hay varias razones por las que no podríamos realizar un experimento aleatorizado, entre ellas la ética, el costo y/o el tiempo.</p>
</blockquote>
<ul>
<li>Métodos estadísticos (como scores de propensión) para calcular un efecto no sesgado de la exposición sobre el resultado.</li>
</ul>
</section></section>
<section id="workflow-de-inferencia-causal" class="title-slide slide level1 center">
<h1>Workflow de inferencia causal</h1>
<p>Análisis causal mediante unos pasos clave:</p>
<ol type="1">
<li>Especificar pregunta causal</li>
<li>Dibujar hipótesis mediante un diagrama causal</li>
<li>Modelar supuestos</li>
<li>Diagnosticar modelos</li>
<li>Estimar el efecto causal</li>
<li>Estimar varianza del efecto</li>
</ol>
</section>

<section>
<section id="datos" class="title-slide slide level1 center">
<h1>Datos</h1>
<p>Ejercición y datos <strong>simulados</strong> por el Dr.&nbsp;Andrew Heiss tomados del curso <a href="https://evalsp21.classes.andrewheiss.com/example/matching-ipw/#program-background">PMAP 8141 Program Evaluation for Public Service</a> de Georgia State University:</p>
<blockquote>
<p><strong>OBJ:</strong> saber si el uso de mosquiteros disminuye el riesgo de que un hogar contraiga malaria.</p>
</blockquote>
<p>Universo de 1,752 hogares de un país sin nombre y tienen variables relacionadas con factores ambientales, la salud individual y las características del hogar.</p>
<p>Los datos no son experimentales: los investigadores no tienen control sobre quién utiliza mosquiteros, y cada hogar decide por sí mismo si los solicita gratuitos o las compra, y si los utiliza en caso de tenerlas.</p>
</section>
<section id="setup" class="slide level2">
<h2>Setup</h2>
<p>Paquetes de R</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># manipulación de datos</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(broom) <span class="co"># convertir modelos a data frames</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(causalworkshop) <span class="co"># datos y librerías </span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(propensity) <span class="co"># estimación de propensión</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(MatchIt)  <span class="co"># match things</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(ggdag)  <span class="co"># crear DAGs</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="fu">library</span>(dagitty)  <span class="co"># usar lógica de DAGs</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">library</span>(halfmoon) <span class="co"># graficos </span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="fu">library</span>(rsample) <span class="co"># remuestreo </span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="fu">library</span>(tipr) <span class="co"># sensitivity analysis </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La estructura de los datos y una muestra se presentan a continuación:</p>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">Estructura</a></li><li><a href="#tabset-1-2">Muestra</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>net_data_full <span class="sc">|&gt;</span> <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [1,752 × 11] (S3: tbl_df/tbl/data.frame)
 $ id                    : int [1:1752] 1 2 3 4 5 6 7 8 9 10 ...
 $ net                   : logi [1:1752] FALSE FALSE FALSE FALSE FALSE FALSE ...
 $ net_num               : int [1:1752] 0 0 0 0 0 0 0 0 0 0 ...
 $ malaria_risk          : num [1:1752] 38 48 32 55 36 30 29 45 51 42 ...
 $ income                : num [1:1752] 779 700 1083 753 919 ...
 $ health                : num [1:1752] 35 35 58 68 46 37 58 30 18 64 ...
 $ household             : num [1:1752] 1 3 3 3 5 3 1 2 3 3 ...
 $ eligible              : logi [1:1752] FALSE FALSE FALSE FALSE FALSE FALSE ...
 $ temperature           : num [1:1752] 18.3 18.6 24.2 19.1 21.2 20.2 18.9 28.8 19.9 21.4 ...
 $ insecticide_resistance: num [1:1752] 38 40 70 57 59 49 52 42 66 45 ...
 $ genetic_resistance    : int [1:1752] 0 0 0 0 0 0 0 1 0 0 ...</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(net_data_full <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table>
<colgroup>
<col style="width: 2%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 11%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 10%">
<col style="width: 19%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: left;">net</th>
<th style="text-align: right;">net_num</th>
<th style="text-align: right;">malaria_risk</th>
<th style="text-align: right;">income</th>
<th style="text-align: right;">health</th>
<th style="text-align: right;">household</th>
<th style="text-align: left;">eligible</th>
<th style="text-align: right;">temperature</th>
<th style="text-align: right;">insecticide_resistance</th>
<th style="text-align: right;">genetic_resistance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">779</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">18.3</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">700</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">18.6</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">1083</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">24.2</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="variables" class="slide level2">
<h2>Variables</h2>
<ul>
<li>Riesgo de malaria (<code>malaria_risk</code>): La proba de que alguien en el hogar se infecte de malaria. Se mide en una escala de 0 a 100, donde 100 indica mayor riesgo.</li>
<li>Mosquitero (<code>net and net_num</code>): Variable binaria que indica si el hogar utilizó mosquiteros.</li>
<li>Elegible para el programa (<code>eligible</code>): Variable binaria que indica si el hogar es elegible para el programa de mosquiteros gratuitos.</li>
<li>Ingresos (<code>income</code>): Los ingresos mensuales del hogar, en dólares.</li>
<li>Temperatura (<code>temperature</code>): La temperatura media nocturna, en grados Celsius.</li>
<li>Salud (<code>health</code>): Estado de salud autodeclarado en el hogar. Se mide en una escala de 0 a 100. Los valores más altos indican mejor salud.</li>
<li>Número de personas en el hogar (<code>household</code>): Número de personas que viven en el hogar</li>
<li>Resistencia a insecticidas (<code>insectide_resistance</code>): Algunas cepas de mosquitos son más resistentes a los insecticidas y, por tanto, suponen un mayor riesgo de infectar a las personas con malaria. Se mide en una escala de 0 a 100, en la que los valores más altos indican una mayor resistencia.</li>
<li>Resistencia genética (<code>genetic_resistance</code>): Variable binaria que indica si el hogar tiene resistencia genética la malaria, lo que reduce el riesgo de malaria.</li>
</ul>
</section>
<section id="caso-malaria-proceso-de-análisis" class="slide level2">
<h2>[Caso Malaria] Proceso de análisis</h2>
<p>Para calcular este efecto</p>
<ol type="1">
<li>Especificar pregunta causal (para el efecto medio del tratamiento ATE)</li>
<li>Dibujar hipótesis mediante un diagrama causal (utilizando DAG)</li>
<li>Modelar supuestos (utilizando el score de propensión)</li>
<li>Diagnosticar modelos (comprobando el equilibrio de los factores de confusión tras la ponderación)</li>
<li>Estimar el efecto causal (mediante ponderación de probabilidad inversa y matching)</li>
<li>Estimar varianza del efecto (mediante bootstrap)</li>
</ol>
</section></section>
<section>
<section id="pregunta-causal" class="title-slide slide level1 center">
<h1>1. Pregunta causal</h1>
<p>Definición de los términos:</p>
<ul>
<li><em>exposure</em> (la causa)</li>
<li><em>outcome</em> (el efecto)</li>
<li>criterios de elegibilidad (¿para quién?)</li>
<li>tiempo cero (¿cuándo se empezó a seguir a los participantes?)</li>
<li>población objetivo, (¿para quién podemos estimar un efecto de resultado?)</li>
<li>periodo de seguimiento (¿cuándo?)</li>
</ul>

<img data-src="img/01_diagram_causal.png" style="width:90.0%" class="r-stretch"></section>
<section id="caso-malaria-riesgo-de-malaria" class="slide level2">
<h2>[Caso Malaria] Riesgo de malaria</h2>
<p>Utilizaremos datos simulados para responder a una pregunta más específica: ¿Disminuye el riesgo de contraer la malaria al cabo de 1 año si se utilizan mosquiteros tratados con insecticida en comparación con si no se utilizan?</p>
<ul>
<li><em>exposure</em>: uso de mosquiteros tratados con insecticida</li>
<li><em>outcome</em> riesgo de contraer malaria</li>
<li>criterios de elegibilidad: hogares<br>
</li>
<li>tiempo cero: inicio de verano</li>
<li>población objetivo: hogares de un país sin nombre</li>
<li>periodo de seguimiento: un año</li>
</ul>

<img data-src="img/02_diagram_causal_malaria.png" style="width:90.0%" class="r-stretch"></section>
<section id="caso-malaria-distribución-del-riesgo" class="slide level2">
<h2>[Caso Malaria] Distribución del riesgo</h2>
<p>La distribución del riesgo observado en los que usan el mosquitero es el siguiente:</p>
<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1">Grafica</a></li><li><a href="#tabset-2-2">Promedio</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>net_data_full <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(malaria_risk, <span class="at">fill =</span> net)) <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="cn">NA</span>, <span class="at">alpha =</span> .<span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="psm_files/figure-revealjs/unnamed-chunk-4-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>net_data_full <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="fu">group_by</span>(net) <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="fu">summarize</span>(<span class="at">malaria_risk =</span> <span class="fu">mean</span>(malaria_risk)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  net   malaria_risk
  &lt;lgl&gt;        &lt;dbl&gt;
1 FALSE         43.9
2 TRUE          27.5</code></pre>
</div>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="diagrama-causal" class="title-slide slide level1 center">
<h1>2. Diagrama causal</h1>
<p>Los diagramas causales que utilizamos también se denominan grafos acíclicos dirigidos (DAG). Estos grafos son dirigidos porque incluyen flechas que van en una dirección específica. Son acíclicos porque no van en círculos; por ejemplo, una variable no puede causarse a sí misma.</p>

<img data-src="img/01_diagram_causal_types.png" style="width:60.0%" class="r-stretch quarto-figure-center"><p>El tipo de ruta <strong>fork</strong> es una ruta de confusión. Dado que <span class="math inline">\(q\)</span> causa tanto <span class="math inline">\(x\)</span> como <span class="math inline">\(y\)</span>, <span class="math inline">\(x\)</span> y <span class="math inline">\(y\)</span> tendrán una asociación espuria. Ambos contienen información de <span class="math inline">\(q\)</span>, su causa mutua.</p>
<p>Esa relación causal mutua hace que <span class="math inline">\(x\)</span> y <span class="math inline">\(y\)</span> se asocien estadísticamente. El ajuste por <span class="math inline">\(q\)</span> bloqueará el sesgo de confusión y nos dará la verdadera relación entre <span class="math inline">\(x\)</span> e <span class="math inline">\(y\)</span>.</p>
<blockquote>
<p><strong>DEF:</strong> Un <strong>factor de confusión</strong> es una causa común de exposición y resultado.</p>
</blockquote>
</section>
<section id="caso-malaria-diagrama-de-causalidad" class="slide level2">
<h2>[Caso Malaria] Diagrama de causalidad</h2>

<img data-src="psm_files/figure-revealjs/unnamed-chunk-6-1.png" width="672" class="r-stretch quarto-figure-center"><ul>
<li>El riesgo de malaria depende del uso de mosquiteros, los ingresos, la salud, la temperatura, la resistencia a los insecticidas y la resistencia genética.</li>
<li>El uso de mosquiteros depende de los ingresos, la salud, la temperatura, la elegibilidad para el programa de mosquiteros gratuitos, el número de personas en el hogar y la resistencia genética.</li>
<li>La elegibilidad para los programas de mosquiteros gratuitos viene determinada por los ingresos y el número de personas en un hogar.</li>
<li>La salud depende de los ingresos.</li>
</ul>
</section>
<section id="caso-malaria-hipótesis-de-efecto" class="slide level2">
<h2>[Caso Malaria] Hipótesis de efecto</h2>
<p>Siguiendo la lógica de <em>do-calculus</em>, podemos encontrar todos los nodos que confunden la relación entre el uso de mosquiteros y el riesgo de malaria, ya que esos nodos abren caminos secundarios y distorsionan el efecto causal que nos interesa.</p>
<p>La función <code>adjustmentSets()</code> enumera conjuntos de covariables que (asintóticamente) permiten la estimación insesgada de efectos causales a partir de datos observacionales. Se asume que el gráfico causal de entrada es correcto.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">adjustmentSets</span>(malaria_dag)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{ genetic_resistance, health, income, temperature }</code></pre>
</div>
</div>
</section></section>
<section>
<section id="modelar-hipótesis" class="title-slide slide level1 center">
<h1>3. Modelar hipótesis</h1>
<p>Propensity score matching simula la relación entre la exposición y el resultado si hubiéramos realizado un ensayo aleatorio. La correlación entre la exposición y el resultado estimará el efecto causal tras estimar score de propensión.</p>
<p>Rosenbaum y Rubin (1983) demostraron que en los estudios observacionales el condicionamiento a los scores de propensión puede conducir a estimaciones <strong>no sesgadas</strong> del efecto siempre y cuando se cumplan los supuestos:</p>
<ul>
<li>No hay factores de confusión no medidos</li>
<li>Cada sujeto tiene una probabilidad distinta de cero de recibir una u otra exposición</li>
</ul>
</section>
<section id="score-de-propensión" class="slide level2">
<h2>Score de propensión</h2>
<p>Al ajustar un modelo de score de propensión, queremos condicionar todos los factores de confusión conocidos.</p>
<blockquote>
<p><strong>DEF:</strong> Un <strong>score de propensión</strong> es la probabilidad de estar en el grupo de exposición, condicionada a las covariables observadas.</p>
</blockquote>
<p>Supongamos que recopilamos información completa sobre todos estos factores de confusión. En ese caso, podríamos determinar la probabilidad de exposición de cada hogar y utilizarla para evaluar un análisis que identifique la relación entre la exposición y algún resultado.</p>
<p>Hay muchas formas de generar scores de propensión (como la regresión logística, la regresión probit e incluso técnicas de aprendizaje automático como los bosques aleatorios y las redes neuronales), pero la <strong>regresión logística</strong> es probablemente el método más común.</p>
<p>La variable resultado en los modelos de regresión logística debe ser binaria, y las variables explicativas que se incluyen en el modelo ayudan a explicar la variación en la probabilidad del resultado binario.</p>
<p>Hay muchas formas de incorporar el score de propensión a un análisis. Las técnicas más utilizadas incluyen la estratificación (estimación del efecto causal dentro del estrato de puntuación de propensión), el emparejamiento, la ponderación y el ajuste directo de covariables.</p>
</section>
<section id="matching" class="slide level2">
<h2>Matching</h2>
<p>El objetivo es que las observaciones expuestas y no expuestas sean intercambiables con respecto a los factores de confusión que hemos propuesto en nuestro DAG (de forma que podamos utilizar el efecto observado para una para estimar el contrafactual para la otra).</p>
<p>Una forma de hacerlo es garantizar que cada observación de nuestra muestra de análisis tenga al menos una observación de la exposición opuesta que tenga valores coincidentes para cada uno de estos factores de confusión.</p>

<img data-src="img/01_matching.png" class="r-stretch quarto-figure-center"></section>
<section id="caso-malaria-score-de-propensión" class="slide level2">
<h2>[Caso Malaria] Score de propensión</h2>
<p>Construimos el modelo que predice el uso de mosquitero en función de ingreso, temperaturas, salud y resistencia a malaria.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>propensity_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb10-2"><a href="#cb10-2"></a>  net <span class="sc">~</span> income <span class="sc">+</span> health <span class="sc">+</span> temperature <span class="sc">+</span> genetic_resistance,</span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="at">data =</span> net_data_full,</span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="at">family =</span> <span class="fu">binomial</span>()</span>
<span id="cb10-5"><a href="#cb10-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="panel-tabset">
<ul id="tabset-3" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-3-1">Scores</a></li><li><a href="#tabset-3-2">Distribución de scores</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>net_data_ps <span class="ot">&lt;-</span> </span>
<span id="cb11-2"><a href="#cb11-2"></a>  propensity_model <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="fu">augment</span>(<span class="at">newdata =</span> net_data_full, <span class="at">type.predict =</span> <span class="st">"response"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="fu">rename</span>(<span class="at">scores =</span> .fitted)</span>
<span id="cb11-5"><a href="#cb11-5"></a></span>
<span id="cb11-6"><a href="#cb11-6"></a>net_data_ps <span class="sc">|&gt;</span> </span>
<span id="cb11-7"><a href="#cb11-7"></a>  <span class="fu">select</span>(net, scores) <span class="sc">|&gt;</span> </span>
<span id="cb11-8"><a href="#cb11-8"></a>  <span class="fu">sample_n</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  net   scores
  &lt;lgl&gt;  &lt;dbl&gt;
1 FALSE  0.132
2 FALSE  0.132
3 FALSE  0.157
4 FALSE  0.199
5 FALSE  0.213</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">ggplot</span>(net_data_ps, <span class="fu">aes</span>(scores)) <span class="sc">+</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="fu">geom_mirror_histogram</span>(</span>
<span id="cb13-3"><a href="#cb13-3"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> net),</span>
<span id="cb13-4"><a href="#cb13-4"></a>    <span class="at">bins =</span> <span class="dv">50</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>  ) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> abs) <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"propensity score"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="psm_files/figure-revealjs/unnamed-chunk-11-1.png" width="480"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="diagnostico" class="title-slide slide level1 center">
<h1>4. Diagnostico</h1>
<p>Asumiendo un escenario con dos niveles de exposición: - Expuesto <span class="math inline">\(X = 1\)</span> - No expuesto <span class="math inline">\(X=0\)</span></p>
<p>De tal forma que, los resultados potenciales son: - Con exposición (<span class="math inline">\(Y(1) = [Y_1|X=1]\)</span>) - Sin exposición (<span class="math inline">\(Y(0) = [Y_0|X=0]\)</span>).</p>
<p>Entonces, la diferencia entre estos resultados para comprender el impacto de la exposición en el resultado es <span class="math inline">\(Y(1) - Y(0)\)</span>.</p>
<p>Los supuestos son:</p>
<ol type="1">
<li>Consistencia</li>
<li>Intercambiabilidad</li>
<li>Positividad</li>
</ol>
<p>Estos supuestos se denominan a veces condiciones de identificabilidad, ya que necesitamos que se cumplan para identificar las estimaciones causales.</p>
</section>
<section class="slide level2">

<h3 id="consistencia">Consistencia</h3>
<ol type="1">
<li><strong>Consistencia:</strong> Suponemos que la pregunta causal que afirma responder es coherente con la que realmente responde el análisis. Matemáticamente, esto significa: <span class="math display">\[
Y_\texttt{obs} = (X)[Y(1)] + (1-X)[Y(0)].
\]</span></li>
</ol>
<p>En otras palabras, el resultado observado es exactamente igual al resultado potencial bajo la exposición recibida. Dos formas habituales de hablar de este supuesto son:</p>
<ul>
<li><p><strong>Consistencia con exposición bien definida</strong>: Suponemos que para cada valor de la exposición, no hay diferencia entre los sujetos en la asignación de esa exposición. Dicho de otro modo, no existen múltiples versiones del tratamiento.</p></li>
<li><p><strong>Consistencia sin interferencias</strong>: Suponemos que el resultado (técnicamente todos los resultados potenciales, independientemente de si se observan o no) para cualquier sujeto no depende de la exposición de otro sujeto.</p></li>
</ul>
<p>Este supuesto a veces se denomina como supuesto de valor de tratamiento unitario estable (stable-unit-treatment-value-assumption) o <strong>SUTVA</strong> (Imbens y Rubin, 2015).</p>
</section>
<section class="slide level2">

<h3 id="intercambiabilidad">Intercambiabilidad</h3>
<p>Suponemos que dentro de los niveles de las variables relevantes o factores de confusión, los sujetos expuestos y no expuestos tienen la misma probabilidad de experimentar cualquier resultado antes de la exposición; es decir, los sujetos expuestos y no expuestos son intercambiables.</p>
<p>Este supuesto a veces se denomina ausencia de factores de confusión no medidos.</p>
<h3 id="positividad">Positividad</h3>
<p>Suponemos que dentro de cada nivel y combinación de las variables de estudio utilizadas para lograr la intercambiabilidad, hay sujetos expuestos y no expuestos. Dicho de otro modo, cada individuo tiene alguna posibilidad de experimentar cada nivel de exposición disponible. A veces, esto se denomina suposición probabilística.</p>
</section>
<section id="ponderar" class="slide level2">
<h2>Ponderar</h2>
<p>Es común en estos casos observar desbalance en la distribución de los scores entre el grupo de expuestos y no expuestos. Esto es por los conteos más altos del grupo de no expuestos.</p>
<p>La ponderación permite que el score sea suave, aplicando una transformación que permita, en promedio, que las covariables de interés estén equilibradas en la población ponderada. Para ello, construiremos un peso utilizando el score de propensión.</p>
<p>La siguiente ponderación de probabilidad inversa permitirá estimar el efecto usando la ponderación <span class="math inline">\(w_{ATE}\)</span> de efecto promedio del tratamiento del score de propensión <span class="math inline">\(p\)</span>, donde <span class="math inline">\(X\)</span> representa el valor de exposición o tratamiento.</p>
<p><span class="math display">\[
w_{ATE} = \frac{X}{p} - \frac{(1-X)}{(1-p)}
\]</span></p>
</section>
<section id="caso-malaria-ponderación" class="slide level2">
<h2>[Caso Malaria] Ponderación</h2>
<p>Algunos puntos que podemos resaltar para obtener el diagnóstico sobre la distribución de los scores son:</p>
<ol type="1">
<li>Buscar la falta de empalme como posible problema de positividad. Pero, un empalme excesivo puede indicar un modelo deficiente.</li>
<li>El efecto medio del tratamiento entre los tratados es más fácil de estimar con precisión (debido a los conteos más altos) que en el grupo de control o no expuesto.</li>
<li>Un único valor atípico en cualquiera de los grupos en relación con el intervalo podría ser un problema y justifica la revisión de los datos.</li>
</ol>

<img data-src="psm_files/figure-revealjs/unnamed-chunk-12-1.png" width="960" class="r-stretch quarto-figure-center"></section>
<section class="slide level2">

<p>En este caso, la función <code>wt_ate()</code> calcula los pesos de los scores de propensión.</p>
<div class="panel-tabset">
<ul id="tabset-4" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-4-1">Pesos</a></li><li><a href="#tabset-4-2">Distribución de scores ponderados</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>net_data_wts <span class="ot">&lt;-</span> </span>
<span id="cb14-2"><a href="#cb14-2"></a>  propensity_model <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">augment</span>(<span class="at">newdata =</span> net_data_full, </span>
<span id="cb14-4"><a href="#cb14-4"></a>          <span class="at">type.predict =</span> <span class="st">"response"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="fu">rename</span>(<span class="at">scores =</span> .fitted) <span class="sc">|&gt;</span> </span>
<span id="cb14-6"><a href="#cb14-6"></a>  <span class="fu">mutate</span>(<span class="at">wts =</span> <span class="fu">wt_ate</span>(scores, net))</span>
<span id="cb14-7"><a href="#cb14-7"></a></span>
<span id="cb14-8"><a href="#cb14-8"></a>net_data_wts <span class="sc">|&gt;</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>  <span class="fu">select</span>(net, scores, wts) <span class="sc">|&gt;</span></span>
<span id="cb14-10"><a href="#cb14-10"></a>  <span class="fu">head</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  net   scores   wts
  &lt;lgl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 FALSE  0.205  1.26
2 FALSE  0.179  1.22
3 FALSE  0.268  1.37</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">ggplot</span>(net_data_wts, <span class="fu">aes</span>(scores)) <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="fu">geom_mirror_histogram</span>(</span>
<span id="cb16-3"><a href="#cb16-3"></a>    <span class="fu">aes</span>(<span class="at">group =</span> net),</span>
<span id="cb16-4"><a href="#cb16-4"></a>    <span class="at">bins =</span> <span class="dv">50</span></span>
<span id="cb16-5"><a href="#cb16-5"></a>  ) <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>  <span class="fu">geom_mirror_histogram</span>(</span>
<span id="cb16-7"><a href="#cb16-7"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> net, <span class="at">weight =</span> wts),</span>
<span id="cb16-8"><a href="#cb16-8"></a>    <span class="at">bins =</span> <span class="dv">50</span>,</span>
<span id="cb16-9"><a href="#cb16-9"></a>    <span class="at">alpha =</span> .<span class="dv">5</span></span>
<span id="cb16-10"><a href="#cb16-10"></a>  ) <span class="sc">+</span></span>
<span id="cb16-11"><a href="#cb16-11"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> abs) <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"propensity score"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="psm_files/figure-revealjs/unnamed-chunk-14-1.png" width="576"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="caso-malaria-evaluación-de-balance-de-cofounders" class="slide level2">
<h2>[Caso Malaria] Evaluación de balance de cofounders</h2>
<p>Una forma de evaluar el balance de las observaciones entre los cofounders es al calcular las diferencias de medias estandarizadas (SMD) para cada factor de confusión con y sin ponderaciones.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>plot_df <span class="ot">&lt;-</span> <span class="fu">tidy_smd</span>(</span>
<span id="cb17-2"><a href="#cb17-2"></a>  net_data_wts,</span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="fu">c</span>(income, health, temperature, genetic_resistance),</span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="at">.group =</span> net,</span>
<span id="cb17-5"><a href="#cb17-5"></a>  <span class="at">.wts =</span> wts</span>
<span id="cb17-6"><a href="#cb17-6"></a>)</span>
<span id="cb17-7"><a href="#cb17-7"></a></span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="fu">ggplot</span>(</span>
<span id="cb17-9"><a href="#cb17-9"></a>  plot_df,</span>
<span id="cb17-10"><a href="#cb17-10"></a>  <span class="fu">aes</span>(</span>
<span id="cb17-11"><a href="#cb17-11"></a>    <span class="at">x =</span> <span class="fu">abs</span>(smd),</span>
<span id="cb17-12"><a href="#cb17-12"></a>    <span class="at">y =</span> variable,</span>
<span id="cb17-13"><a href="#cb17-13"></a>    <span class="at">group =</span> method,</span>
<span id="cb17-14"><a href="#cb17-14"></a>    <span class="at">color =</span> method</span>
<span id="cb17-15"><a href="#cb17-15"></a>  )</span>
<span id="cb17-16"><a href="#cb17-16"></a>) <span class="sc">+</span></span>
<span id="cb17-17"><a href="#cb17-17"></a>  <span class="fu">geom_love</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="psm_files/figure-revealjs/unnamed-chunk-15-1.png" width="480" class="r-stretch quarto-figure-center"></section>
<section id="caso-malaria-matching" class="slide level2">
<h2>[Caso Malaria] Matching</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>matched <span class="ot">&lt;-</span> <span class="fu">matchit</span>(</span>
<span id="cb18-2"><a href="#cb18-2"></a>  net <span class="sc">~</span> income <span class="sc">+</span> health <span class="sc">+</span> temperature <span class="sc">+</span> genetic_resistance,</span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="at">data =</span> net_data_wts,</span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="at">distance =</span> <span class="st">"glm"</span>,</span>
<span id="cb18-5"><a href="#cb18-5"></a>  <span class="at">link =</span> <span class="st">"logit"</span>, </span>
<span id="cb18-6"><a href="#cb18-6"></a>  <span class="at">s.weights =</span> net_data_wts<span class="sc">$</span>wts,</span>
<span id="cb18-7"><a href="#cb18-7"></a>  <span class="at">replace =</span> F</span>
<span id="cb18-8"><a href="#cb18-8"></a>)</span>
<span id="cb18-9"><a href="#cb18-9"></a>net_matched_wts <span class="ot">&lt;-</span> <span class="fu">get_matches</span>(matched)</span>
<span id="cb18-10"><a href="#cb18-10"></a></span>
<span id="cb18-11"><a href="#cb18-11"></a>matched</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>A matchit object
 - method: 1:1 nearest neighbor matching without replacement
 - distance: Propensity score
             - estimated with logistic regression
             - sampling weights included in estimation
 - number of obs.: 1752 (original), 908 (matched)
 - sampling weights: present
 - target estimand: ATT
 - covariates: income, health, temperature, genetic_resistance</code></pre>
</div>
</div>
</section>
<section id="caso-malaria-muestra-balanceada" class="slide level2">
<h2>[Caso Malaria] Muestra balanceada</h2>
<div class="panel-tabset">
<ul id="tabset-5" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-5-1">Resúmen de matching</a></li><li><a href="#tabset-5-2">Datos emparejados</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">summary</span>(matched)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
matchit(formula = net ~ income + health + temperature + genetic_resistance, 
    data = net_data_wts, distance = "glm", link = "logit", s.weights = net_data_wts$wts, 
    replace = F)

Summary of Balance for All Data:
                   Means Treated Means Control Std. Mean Diff. Var. Ratio
distance                  0.5054        0.5048          0.0463     1.1746
income                  888.4191      895.8192         -0.0369     1.1260
health                   49.4905       50.0986         -0.0298     1.1443
temperature              24.0695       23.9718          0.0231     1.0839
genetic_resistance        0.1005        0.0991          0.0044          .
                   eCDF Mean eCDF Max
distance              0.0159   0.0523
income                0.0148   0.0611
health                0.0154   0.0597
temperature           0.0112   0.0499
genetic_resistance    0.0013   0.0013

Summary of Balance for Matched Data:
                   Means Treated Means Control Std. Mean Diff. Var. Ratio
distance                  0.5054        0.5017          0.2977     1.0547
income                  888.4191      939.1780         -0.2534     1.0324
health                   49.4905       53.9216         -0.2171     1.1587
temperature              24.0695       23.5516          0.1225     1.0346
genetic_resistance        0.1005        0.0913          0.0305          .
                   eCDF Mean eCDF Max Std. Pair Dist.
distance              0.0902   0.1391          0.0160
income                0.0661   0.1203          0.6924
health                0.0469   0.1332          0.8108
temperature           0.0311   0.0708          0.9842
genetic_resistance    0.0092   0.0092          0.8939

Sample Sizes:
              Control Treated
All (ESS)     1198.03  357.71
All           1298.    454.  
Matched (ESS)  418.3   357.71
Matched        454.    454.  
Unmatched      844.      0.  
Discarded        0.      0.  </code></pre>
</div>
</div>
</div>
<div id="tabset-5-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>net_matched_wts <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">20</span>) <span class="sc">|&gt;</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table>
<colgroup>
<col style="width: 3%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 9%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 16%">
<col style="width: 13%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">id</th>
<th style="text-align: left;">subclass</th>
<th style="text-align: right;">weights</th>
<th style="text-align: left;">net</th>
<th style="text-align: right;">malaria_risk</th>
<th style="text-align: right;">income</th>
<th style="text-align: right;">health</th>
<th style="text-align: right;">temperature</th>
<th style="text-align: right;">insecticide_resistance</th>
<th style="text-align: right;">genetic_resistance</th>
<th style="text-align: right;">scores</th>
<th style="text-align: right;">wts</th>
<th style="text-align: right;">distance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">16</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">2.739172</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1251</td>
<td style="text-align: right;">96</td>
<td style="text-align: right;">21.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.3650738</td>
<td style="text-align: right;">2.739172</td>
<td style="text-align: right;">0.4802468</td>
</tr>
<tr class="even">
<td style="text-align: left;">395</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">1.665123</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">1429</td>
<td style="text-align: right;">84</td>
<td style="text-align: right;">26.2</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.3994436</td>
<td style="text-align: right;">1.665123</td>
<td style="text-align: right;">0.4799922</td>
</tr>
<tr class="odd">
<td style="text-align: left;">18</td>
<td style="text-align: left;">2</td>
<td style="text-align: right;">4.354160</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">892</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">20.2</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.2296654</td>
<td style="text-align: right;">4.354160</td>
<td style="text-align: right;">0.4979628</td>
</tr>
<tr class="even">
<td style="text-align: left;">1036</td>
<td style="text-align: left;">2</td>
<td style="text-align: right;">1.308996</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">931</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">20.9</td>
<td style="text-align: right;">74</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.2360556</td>
<td style="text-align: right;">1.308996</td>
<td style="text-align: right;">0.4979406</td>
</tr>
<tr class="odd">
<td style="text-align: left;">19</td>
<td style="text-align: left;">3</td>
<td style="text-align: right;">2.543730</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">1273</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">19.9</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.3931235</td>
<td style="text-align: right;">2.543730</td>
<td style="text-align: right;">0.4759100</td>
</tr>
<tr class="even">
<td style="text-align: left;">1302</td>
<td style="text-align: left;">3</td>
<td style="text-align: right;">1.718578</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1332</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">19.8</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.4181236</td>
<td style="text-align: right;">1.718578</td>
<td style="text-align: right;">0.4737228</td>
</tr>
<tr class="odd">
<td style="text-align: left;">22</td>
<td style="text-align: left;">4</td>
<td style="text-align: right;">2.874226</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">1292</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">24.8</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.3479197</td>
<td style="text-align: right;">2.874226</td>
<td style="text-align: right;">0.4855308</td>
</tr>
<tr class="even">
<td style="text-align: left;">1144</td>
<td style="text-align: left;">4</td>
<td style="text-align: right;">5.189003</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">1179</td>
<td style="text-align: right;">73</td>
<td style="text-align: right;">19.8</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.8072848</td>
<td style="text-align: right;">5.189003</td>
<td style="text-align: right;">0.4855857</td>
</tr>
<tr class="odd">
<td style="text-align: left;">28</td>
<td style="text-align: left;">5</td>
<td style="text-align: right;">3.687558</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">1235</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">31.0</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.2711821</td>
<td style="text-align: right;">3.687558</td>
<td style="text-align: right;">0.4989465</td>
</tr>
<tr class="even">
<td style="text-align: left;">1062</td>
<td style="text-align: left;">5</td>
<td style="text-align: right;">1.307345</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">979</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">23.9</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.2350908</td>
<td style="text-align: right;">1.307345</td>
<td style="text-align: right;">0.4989181</td>
</tr>
<tr class="odd">
<td style="text-align: left;">30</td>
<td style="text-align: left;">6</td>
<td style="text-align: right;">5.672105</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">798</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">23.6</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1763014</td>
<td style="text-align: right;">5.672105</td>
<td style="text-align: right;">0.5094343</td>
</tr>
<tr class="even">
<td style="text-align: left;">1176</td>
<td style="text-align: left;">6</td>
<td style="text-align: right;">1.227997</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">897</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">27.0</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1856658</td>
<td style="text-align: right;">1.227997</td>
<td style="text-align: right;">0.5094434</td>
</tr>
<tr class="odd">
<td style="text-align: left;">32</td>
<td style="text-align: left;">7</td>
<td style="text-align: right;">4.938694</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">933</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">26.0</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.2024827</td>
<td style="text-align: right;">4.938694</td>
<td style="text-align: right;">0.5060671</td>
</tr>
<tr class="even">
<td style="text-align: left;">1409</td>
<td style="text-align: left;">7</td>
<td style="text-align: right;">1.242746</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">852</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">22.8</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1953301</td>
<td style="text-align: right;">1.242746</td>
<td style="text-align: right;">0.5060648</td>
</tr>
<tr class="odd">
<td style="text-align: left;">37</td>
<td style="text-align: left;">8</td>
<td style="text-align: right;">4.391741</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">892</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">20.1</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.2277002</td>
<td style="text-align: right;">4.391741</td>
<td style="text-align: right;">0.4988668</td>
</tr>
<tr class="even">
<td style="text-align: left;">258</td>
<td style="text-align: left;">8</td>
<td style="text-align: right;">1.375431</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">1232</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">30.3</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.2729554</td>
<td style="text-align: right;">1.375431</td>
<td style="text-align: right;">0.4988720</td>
</tr>
<tr class="odd">
<td style="text-align: left;">44</td>
<td style="text-align: left;">9</td>
<td style="text-align: right;">3.259213</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">1240</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">27.3</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.3068225</td>
<td style="text-align: right;">3.259213</td>
<td style="text-align: right;">0.4914008</td>
</tr>
<tr class="even">
<td style="text-align: left;">617</td>
<td style="text-align: left;">9</td>
<td style="text-align: right;">1.428189</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">1189</td>
<td style="text-align: right;">74</td>
<td style="text-align: right;">25.6</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.2998126</td>
<td style="text-align: right;">1.428189</td>
<td style="text-align: right;">0.4913803</td>
</tr>
<tr class="odd">
<td style="text-align: left;">45</td>
<td style="text-align: left;">10</td>
<td style="text-align: right;">1.398386</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">970</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">22.2</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.7151104</td>
<td style="text-align: right;">1.398386</td>
<td style="text-align: right;">0.5012016</td>
</tr>
<tr class="even">
<td style="text-align: left;">616</td>
<td style="text-align: left;">10</td>
<td style="text-align: right;">1.336823</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">1183</td>
<td style="text-align: right;">84</td>
<td style="text-align: right;">31.3</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.2519579</td>
<td style="text-align: right;">1.336823</td>
<td style="text-align: right;">0.5012089</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="estimar-efecto-causal" class="title-slide slide level1 center">
<h1>5. Estimar efecto causal</h1>
<p>Dependiendo del objetivo del estudio o de la pregunta causal, es posible que queramos estimar diferentes estimandos.</p>
<p>A continuación, describiremos dos de los estimadores causales más comunes, sus poblaciones objetivo, las preguntas causales que pueden ayudar a responder y los métodos utilizados para estimarlos.</p>
<p><strong>Estimadores:</strong></p>
<ul>
<li><strong>Average treatment effect</strong> (ATE). La población objetivo es la muestra total o la población de interés.</li>
</ul>
<p>En este caso, el estimando es el valor esperado de la diferencia en los resultados potenciales de todos los individuos.</p>
<p><span class="math display">\[
E[Y(1)- Y(0)]
\]</span></p>
<p>Un ejemplo de pregunta de investigación es ¿Debe aplicarse una política a todos los pacientes elegibles?.</p>
<p>La siguiente ponderación de probabilidad inversa le permitirá estimar ATE utilizando la ponderación del score de propensión:</p>
<p><span class="math display">\[
w_{ATE} = \frac{X}{p} - \frac{(1-X)}{(1-p)}
\]</span></p>
<p>La mayoría de los ensayos controlados aleatorios se diseñan con ATE como estimación objetivo.</p>
</section>
<section class="slide level2">

<ul>
<li><strong>Average treatment effect among the treated</strong> (ATT). La población objetivo para estimar el efecto medio del tratamiento entre los tratados (ATT) es la población expuesta (tratada).</li>
</ul>
<p>Este estimador causal condiciona a aquellos en el grupo expuesto:</p>
<p><span class="math display">\[
E[Y(1)- Y(0)|X=1]
\]</span></p>
<p>Ejemplos de preguntas de investigación son: ¿Deberíamos detener nuestra campaña de marketing para aquellos que actualmente lo reciben? o ¿Deberían los proveedores médicos dejar de recomendar el tratamiento a aquellos que actualmente lo reciben? (Greifer y Stuart 2021)</p>
<p>ATT puede estimarse mediante ponderación. La ponderación se estima de la forma:</p>
<p><span class="math display">\[
w_{ATT} = X - \frac{(1-X) \cdot p}{(1-p)}
\]</span></p>
<p>Es común usar ATT cuando se utiliza matching, todas las observaciones expuestas se incluyen y se “emparejan” con las observaciones de control, algunas de las cuales pueden descartarse.</p>
</section>
<section id="caso-malaria-estimación-de-diferencia" class="slide level2">
<h2>[Caso Malaria] Estimación de diferencia</h2>
<p>Estimación de diferencia <span class="math inline">\([Y(1) - Y(0)]\)</span>:</p>
<p>Estimación <em>naive</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>(reg_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(malaria_risk <span class="sc">~</span> net, </span>
<span id="cb23-2"><a href="#cb23-2"></a>                <span class="at">data =</span> net_data_full) <span class="sc">|&gt;</span> </span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="fu">tidy</span>(<span class="at">conf.int =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term        estimate std.error statistic  p.value conf.low conf.high
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)     43.9     0.377     116.  0            43.2      44.7
2 netTRUE        -16.4     0.741     -22.1 1.10e-95    -17.8     -14.9</code></pre>
</div>
</div>
<p>Estimación <em>matched</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>(reg_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(malaria_risk <span class="sc">~</span> net, </span>
<span id="cb25-2"><a href="#cb25-2"></a>                <span class="at">data =</span> net_matched_wts) <span class="sc">|&gt;</span> </span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="fu">tidy</span>(<span class="at">conf.int =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term        estimate std.error statistic  p.value conf.low conf.high
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)     40.8     0.594      68.6 0            39.6      42.0
2 netTRUE        -13.3     0.840     -15.8 9.84e-50    -14.9     -11.6</code></pre>
</div>
</div>
<p>Estimación <em>matched + weights</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>(reg_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(malaria_risk <span class="sc">~</span> net, </span>
<span id="cb27-2"><a href="#cb27-2"></a>                <span class="at">data =</span> net_matched_wts, </span>
<span id="cb27-3"><a href="#cb27-3"></a>                <span class="at">weights =</span> weights) <span class="sc">|&gt;</span> </span>
<span id="cb27-4"><a href="#cb27-4"></a>  <span class="fu">tidy</span>(<span class="at">conf.int =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term        estimate std.error statistic   p.value conf.low conf.high
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)    39.1      0.832     47.1  1.44e-245    37.5      40.8 
2 netTRUE        -7.11     0.966     -7.36 4.04e- 13    -9.01     -5.22</code></pre>
</div>
</div>
</section>
<section id="estimación-de-varianza" class="slide level2">
<h2>6. Estimación de varianza</h2>
<p>Una forma de estimar la varianza del estimador es mediante <strong>Bootstrap Sampling</strong>. Bootstrap es un algoritmo sencillo para calcular estimaciones o estadísticos medianteremuestreo con sustitución.</p>
<p>Resulta útil cuando no existe una solución de forma cerrada para calcular algo, como suele ocurrir en la inferencia causal (sobre todo para los errores estándar), y cuando sospechamos que los cálculos paramétricos no son válidos para una situación determinada.</p>
<p>El proceso consiste en:</p>
<ol type="1">
<li>Re muestrear los datos con reemplazo</li>
<li>Ajustar el estimador a la muestra Bootstrap</li>
<li>Repite R veces.</li>
</ol>
<p>Finalmente, se obtiene la distribución de estimaciones, con la que podemos calcular estadísticos descriptivos de población, como estimaciones puntuales, errores estándar e intervalos de confianza.</p>
</section>
<section id="caso-malaria-muestras-bootstrap" class="slide level2">
<h2>[Caso Malaria] Muestras bootstrap</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="fu">set.seed</span>(<span class="dv">19871002</span>)</span>
<span id="cb29-2"><a href="#cb29-2"></a></span>
<span id="cb29-3"><a href="#cb29-3"></a>bootstrapped_net_data <span class="ot">&lt;-</span> <span class="fu">bootstraps</span>(</span>
<span id="cb29-4"><a href="#cb29-4"></a>  net_data_full,</span>
<span id="cb29-5"><a href="#cb29-5"></a>  <span class="at">times =</span> <span class="dv">500</span>,</span>
<span id="cb29-6"><a href="#cb29-6"></a>  <span class="at">apparent =</span> <span class="cn">TRUE</span></span>
<span id="cb29-7"><a href="#cb29-7"></a>)</span>
<span id="cb29-8"><a href="#cb29-8"></a></span>
<span id="cb29-9"><a href="#cb29-9"></a>bootstrapped_net_data <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  splits             id          
  &lt;list&gt;             &lt;chr&gt;       
1 &lt;split [1752/634]&gt; Bootstrap001
2 &lt;split [1752/639]&gt; Bootstrap002
3 &lt;split [1752/654]&gt; Bootstrap003
4 &lt;split [1752/651]&gt; Bootstrap004
5 &lt;split [1752/624]&gt; Bootstrap005
6 &lt;split [1752/664]&gt; Bootstrap006</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>bootstrapped_net_data<span class="sc">$</span>splits[[<span class="dv">10</span>]] <span class="sc">|&gt;</span> <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 4
 $ data  : tibble [1,752 × 7] (S3: tbl_df/tbl/data.frame)
  ..$ net                   : logi [1:1752] FALSE FALSE FALSE FALSE FALSE FALSE ...
  ..$ malaria_risk          : num [1:1752] 38 48 32 55 36 30 29 45 51 42 ...
  ..$ income                : num [1:1752] 779 700 1083 753 919 ...
  ..$ health                : num [1:1752] 35 35 58 68 46 37 58 30 18 64 ...
  ..$ temperature           : num [1:1752] 18.3 18.6 24.2 19.1 21.2 20.2 18.9 28.8 19.9 21.4 ...
  ..$ insecticide_resistance: num [1:1752] 38 40 70 57 59 49 52 42 66 45 ...
  ..$ genetic_resistance    : int [1:1752] 0 0 0 0 0 0 0 1 0 0 ...
 $ in_id : int [1:1752] 1680 37 1034 859 627 830 1517 1600 1088 1460 ...
 $ out_id: logi NA
 $ id    : tibble [1 × 1] (S3: tbl_df/tbl/data.frame)
  ..$ id: chr "Bootstrap010"
 - attr(*, "class")= chr [1:2] "boot_split" "rsplit"</code></pre>
</div>
</div>
</section>
<section id="ajustar-workflow" class="slide level2">
<h2>Ajustar workflow</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># Función de workflow</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>fit_psm <span class="ot">&lt;-</span> <span class="cf">function</span>(split) {</span>
<span id="cb33-3"><a href="#cb33-3"></a>  <span class="co"># convierte muestra bootstrapped a df</span></span>
<span id="cb33-4"><a href="#cb33-4"></a>  .df <span class="ot">&lt;-</span> <span class="fu">analysis</span>(split)</span>
<span id="cb33-5"><a href="#cb33-5"></a></span>
<span id="cb33-6"><a href="#cb33-6"></a>  formula_net <span class="ot">&lt;-</span>  net <span class="sc">~</span> income <span class="sc">+</span> health <span class="sc">+</span> temperature <span class="sc">+</span> genetic_resistance</span>
<span id="cb33-7"><a href="#cb33-7"></a>  <span class="co"># Estimas scores</span></span>
<span id="cb33-8"><a href="#cb33-8"></a>  p_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb33-9"><a href="#cb33-9"></a>    formula_net,</span>
<span id="cb33-10"><a href="#cb33-10"></a>    <span class="at">data =</span> .df,</span>
<span id="cb33-11"><a href="#cb33-11"></a>    <span class="at">family =</span> <span class="fu">binomial</span>()</span>
<span id="cb33-12"><a href="#cb33-12"></a>  )</span>
<span id="cb33-13"><a href="#cb33-13"></a></span>
<span id="cb33-14"><a href="#cb33-14"></a>  <span class="co"># Calculo de pesos</span></span>
<span id="cb33-15"><a href="#cb33-15"></a>  .df <span class="ot">&lt;-</span> p_model <span class="sc">|&gt;</span></span>
<span id="cb33-16"><a href="#cb33-16"></a>    <span class="fu">augment</span>(<span class="at">type.predict =</span> <span class="st">"response"</span>, <span class="at">data =</span> .df) <span class="sc">|&gt;</span></span>
<span id="cb33-17"><a href="#cb33-17"></a>    <span class="fu">mutate</span>(<span class="at">wts =</span> <span class="fu">wt_ate</span>(.fitted, net))</span>
<span id="cb33-18"><a href="#cb33-18"></a></span>
<span id="cb33-19"><a href="#cb33-19"></a>  <span class="co"># Match de hogares</span></span>
<span id="cb33-20"><a href="#cb33-20"></a>  matched <span class="ot">&lt;-</span> <span class="fu">matchit</span>(</span>
<span id="cb33-21"><a href="#cb33-21"></a>    formula_net,</span>
<span id="cb33-22"><a href="#cb33-22"></a>    <span class="at">data =</span> .df,</span>
<span id="cb33-23"><a href="#cb33-23"></a>    <span class="at">distance =</span> <span class="st">"glm"</span>,</span>
<span id="cb33-24"><a href="#cb33-24"></a>    <span class="at">link =</span> <span class="st">"logit"</span>, </span>
<span id="cb33-25"><a href="#cb33-25"></a>    <span class="at">s.weights =</span> .df<span class="sc">$</span>wts,</span>
<span id="cb33-26"><a href="#cb33-26"></a>    <span class="at">replace =</span> T</span>
<span id="cb33-27"><a href="#cb33-27"></a>  )</span>
<span id="cb33-28"><a href="#cb33-28"></a>  .df <span class="ot">&lt;-</span> <span class="fu">get_matches</span>(matched)</span>
<span id="cb33-29"><a href="#cb33-29"></a>  </span>
<span id="cb33-30"><a href="#cb33-30"></a>  <span class="co"># Estimación de efecto</span></span>
<span id="cb33-31"><a href="#cb33-31"></a>  <span class="fu">lm</span>(malaria_risk <span class="sc">~</span> net, <span class="at">data =</span> .df, <span class="at">weights =</span> wts) <span class="sc">|&gt;</span></span>
<span id="cb33-32"><a href="#cb33-32"></a>    <span class="fu">tidy</span>()</span>
<span id="cb33-33"><a href="#cb33-33"></a>}</span>
<span id="cb33-34"><a href="#cb33-34"></a></span>
<span id="cb33-35"><a href="#cb33-35"></a><span class="co"># Ejecución de la función a cada muestra</span></span>
<span id="cb33-36"><a href="#cb33-36"></a>ipw_results <span class="ot">&lt;-</span> </span>
<span id="cb33-37"><a href="#cb33-37"></a>  bootstrapped_net_data <span class="sc">|&gt;</span></span>
<span id="cb33-38"><a href="#cb33-38"></a>  <span class="fu">mutate</span>(<span class="at">boot_fits =</span> <span class="fu">map</span>(splits, fit_psm))</span>
<span id="cb33-39"><a href="#cb33-39"></a></span>
<span id="cb33-40"><a href="#cb33-40"></a><span class="co"># Muestra de un elemento</span></span>
<span id="cb33-41"><a href="#cb33-41"></a>ipw_results<span class="sc">$</span>boot_fits[[<span class="dv">30</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term        estimate std.error statistic   p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)    33.6      0.800     42.0  9.45e-211
2 netTRUE        -2.19     0.946     -2.31 2.09e-  2</code></pre>
</div>
</div>
</section>
<section id="resúmen-de-distribución" class="slide level2">
<h2>Resúmen de distribución</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>ipw_results <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-3"><a href="#cb35-3"></a>    <span class="at">estimate =</span> <span class="fu">map_dbl</span>(</span>
<span id="cb35-4"><a href="#cb35-4"></a>      boot_fits,</span>
<span id="cb35-5"><a href="#cb35-5"></a>      <span class="co"># pull the `estimate` for `netTRUE` for each fit</span></span>
<span id="cb35-6"><a href="#cb35-6"></a>      \(.fit) .fit <span class="sc">|&gt;</span></span>
<span id="cb35-7"><a href="#cb35-7"></a>        <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"netTRUE"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-8"><a href="#cb35-8"></a>        <span class="fu">pull</span>(estimate)</span>
<span id="cb35-9"><a href="#cb35-9"></a>    )</span>
<span id="cb35-10"><a href="#cb35-10"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb35-11"><a href="#cb35-11"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(estimate)) <span class="sc">+</span></span>
<span id="cb35-12"><a href="#cb35-12"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">"#006EC1"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span> </span>
<span id="cb35-13"><a href="#cb35-13"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="sc">-</span><span class="dv">10</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linetype =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="psm_files/figure-revealjs/unnamed-chunk-25-1.png" width="960" class="r-stretch quarto-figure-center"></section>
<section id="conclusión" class="slide level2">
<h2>Conclusión</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>boot_estimate <span class="ot">&lt;-</span> ipw_results <span class="sc">|&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>  <span class="co"># calcula el estadístico T con IC</span></span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="fu">int_t</span>(boot_fits) <span class="sc">|&gt;</span></span>
<span id="cb36-4"><a href="#cb36-4"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"netTRUE"</span>)</span>
<span id="cb36-5"><a href="#cb36-5"></a></span>
<span id="cb36-6"><a href="#cb36-6"></a>boot_estimate <span class="sc">|&gt;</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table>
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">.lower</th>
<th style="text-align: right;">.estimate</th>
<th style="text-align: right;">.upper</th>
<th style="text-align: right;">.alpha</th>
<th style="text-align: left;">.method</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">netTRUE</td>
<td style="text-align: right;">-10.74012</td>
<td style="text-align: right;">-7.827981</td>
<td style="text-align: right;">-2.94132</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: left;">student-t</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>La estimación del efecto de todos los hogares que utilizan mosquiteros frente a ningún hogar que los utiliza sobre el riesgo de malaria es de -7.8 (IC del 95%: -10.7; -2.9).</p>
<p>Se puede concluir que los mosquiteros parecen reducir el riesgo en este estudio.</p>
</section></section>
<section id="dudas" class="title-slide slide level1 center">
<h1>Dudas</h1>

<img data-src="img/03_xkcd.png" style="width:90.0%" class="r-stretch"><p><strong>¡Gracias!</strong></p>
</section>

<section id="referencias" class="title-slide slide level1 center">
<h1>Referencias</h1>
<p>Repositorio Código <a href="https://github.com/Songeo/causal_psm_sharingwisdom/tree/main">Github</a></p>
<ul>
<li><a href="https://evalsp21.classes.andrewheiss.com/example/matching-ipw/#program-background">Matching and inverse probability weighting</a>. Dr.&nbsp;Andrew Heiss. Georgia State University. Andrew Young School of Policy Studies. October 2, 2020.</li>
<li><a href="https://www.r-causal.org/">Causal Inference in R</a> Barrett M, D’Agostino McGowan L, Gerke T. r-causal.org. March 2024.</li>
<li><a href="https://www.hsph.harvard.edu/miguel-hernan/wp-content/uploads/sites/1268/2024/01/hernanrobins_WhatIf_2jan24.pdf">Causal Inference: What If</a>. Hernán, M. A. and Robins, J. M. Chapman Hall/CRC. 2021.</li>
<li>Greifer, Noah, and Elizabeth A Stuart. 2021. Choosing the Estimand When Matching or Weighting in Observational Studies. arXiv Preprint arXiv:2106.10577.</li>
<li>Rosenbaum, Paul R and Rubin, Donald B. 1983. The central role of the propensity score in observational studies for causal effects. Biometrika. volume 70, pages 41–55.</li>
<li>Netflix Technology Blog. 2022. <a href="https://netflixtechblog.com/a-survey-of-causal-inference-applications-at-netflix-b62d25175e6f">A Survey of Causal Inference Applications at Netflix</a>.</li>
<li>Alexander L, Lopes B, Ricchetti-Masterson K and Yeatts B. 2015. <a href="https://sph.unc.edu/wp-content/uploads/sites/112/2015/07/nciph_ERIC9.pdf">Ecologic Studies</a>. Second Edition. UNC CH Department of Epidemiology Medic.</li>
</ul>
</section>

<section id="librerías" class="title-slide slide level1 center">
<h1>Librerías</h1>
<ul>
<li><a href="https://www.tidyverse.org/"><code>tidyverse</code></a> Wickham H, et al.&nbsp;(2019). R package version 2.0.0</li>
<li><a href="https://r-causal.github.io/tipr/"><code>broom</code></a> Robinson D, Hayes A, Couch S (2023). R package version 1.0.5</li>
<li><a href="https://github.com/malcolmbarrett/causalworkshop"><code>causalworkshop</code></a> Barrett M, D’Agostino McGowan L (2024). R package version 0.1.0</li>
<li><a href="https://r-causal.github.io/propensity/"><code>propensity</code></a> Barrett M (2024). R package version 0.0.0.9000</li>
<li><a href="https://doi.org/10.18637/jss.v042.i08"><code>MatchIt</code></a> Ho D, Imai K, King G, Stuart E (2011). R package version 4.5.5</li>
<li><a href="https://github.com/r-causal/ggdag"><code>ggdag</code></a> Barrett M (2024). R package version 0.2.11.9000</li>
<li><a href="https://doi.org/10.1093/ije/dyw341"><code>dagitty</code></a> Textor J, van der Zander B, Gilthorpe MS (2016). R package version 0.3.4</li>
<li><a href="https://CRAN.R-project.org/package=halfmoon"><code>halfmoon</code></a> Barrett M (2023). R package version 0.1.0</li>
<li><a href="https://CRAN.R-project.org/package=rsample"><code>rsample</code></a> Frick H, Chow F, Kuhn M, Mahoney M, Silge J, Wickham H (2023). R package version 1.2.0</li>
</ul>
<div class="footer footer-default">

</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="psm_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="psm_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="psm_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="psm_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="psm_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="psm_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="psm_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="psm_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="psm_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="psm_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="psm_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': true,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":false},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>